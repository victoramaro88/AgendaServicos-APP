<app-menu></app-menu>

<div *ngIf="boolLoading" class="text-center">
  <p-progressBar mode="indeterminate"></p-progressBar>
  <b><p>CARREGANDO...</p></b>
</div>
<p-blockUI [blocked]="boolLoading"></p-blockUI>
<p-toast  position="top-center"></p-toast>

<h1>Equipes</h1>

<!-- LISTANDO NA GRID -->
<div *ngIf="!modoEdicao && listaUsuarioTb.length > 0">
  <p-table #dt1
  [value]="listaEquipe"
  styleClass="p-datatable-striped p-datatable-sm"
  [paginator]="true" [rows]="10"
  [globalFilterFields]="['equipDesc','maqModelo']"
  >
  <ng-template pTemplate="caption">
    <div class="p-d-flex text-right">
      <span class="mb-3">
        <button (click)="ListaUsuariosDisponiveis()" pButton pRipple pTooltip="Novo Registro" tooltipPosition="left" type="button" label="Novo" class="p-button-raised"></button>
      </span>
      &nbsp;
      <span class="p-input-icon-left p-ml-auto">
        <i class="pi pi-search"></i>
        <input #Filtro pInputText type="text" (input)="dt1.filterGlobal(Filtro.value, 'contains')" placeholder="Pesquisa Global" class="p-inputtext-sm"/>
      </span>
    </div>
  </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="equipDesc">Descrição <p-sortIcon field="equipDesc"></p-sortIcon></th>
        <th>Máquina</th>
        <th>Ap. Navegação</th>
        <th pSortableColumn="equipStatus">Status <p-sortIcon field="equipStatus"></p-sortIcon></th>
        <th>Ações</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td><span class="p-column-title"><b>Descrição</b></span>{{item.equipDesc}}</td>
        <td><span class="p-column-title"><b>Máquina</b></span>{{SelecionaMaquina(item.maqCod)}}</td>
        <td><span class="p-column-title"><b>Ap. Navegação</b></span>{{SelecionaApNaveg(item.apNavCod)}}</td>
        <td><span class="p-column-title"><b>Status</b></span>
          <p-tag severity="{{item.equipStatus ? 'success' : 'danger'}}" value="{{item.equipStatus ? 'Ativo' : 'Inativo'}}"></p-tag>
        </td>
        <td>
          <span class="p-column-title"><b>Ações</b></span>
          <div>
            <button (click)="IniciaEdicao(item);" pTooltip="Editar" tooltipPosition="top" pButton pRipple type="button" icon="pi pi-pencil" class="p-button-rounded p-button-info p-button-text"></button>
            <button (click)="AlteraStatus(item); item.equipStatus = !item.equipStatus;" *ngIf="item.equipStatus" pTooltip="Desativar" tooltipPosition="top" pButton pRipple type="button" icon="pi pi-lock" class="p-button-rounded p-button-success p-button-text"></button>
            <button (click)="AlteraStatus(item); item.equipStatus = !item.equipStatus;" *ngIf="!item.equipStatus" pTooltip="Ativar" tooltipPosition="top" pButton pRipple type="button" icon="pi pi-lock-open" class="p-button-rounded p-button-danger p-button-text"></button>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td style="text-align: center;" colspan="6">Sem informações.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- MODO INCLUSÃO/ALTERAÇÃO -->
<div *ngIf="modoEdicao" class="card">
  <div class="formgrid grid">
      <div class="field col-12 lg:col-2 md:col-4 sm:col-6">
          <label for="equipDesc">Descrição</label><span class="campoObrigatorio">*</span>
          <input [(ngModel)]="objEquipe.equipDesc" id="equipDesc" type="text" class="p-inputtext-sm inputfield w-full" pInputText>
      </div>
      <!-- <div class="field col-12 lg:col-2 md:col-4 sm:col-6">
        <label for="maqModelo">Modelo</label><span class="campoObrigatorio">*</span>
        <input [(ngModel)]="objMaquina.maqModelo" id="maqModelo" type="text" class="p-inputtext-sm inputfield w-full" pInputText>
      </div> -->
      <div class="field col-12 lg:col-3 md:col-4 sm:col-6">
        <label for="veicCod">Máquina</label><span class="campoObrigatorio">*</span><br>
        <p-dropdown id="veicCod" [options]="listaMaquinaDisponiveis" [(ngModel)]="objEquipe.maqCod" autoWidth="false" [style]="{'width':'100%'}" class="p-inputtext-sm inputfield w-full" optionLabel="maqMarca" optionValue="maqCod" placeholder="Selecione uma máquina" [showClear]="true"></p-dropdown>
      </div>
      <div class="field col-12 lg:col-3 md:col-4 sm:col-6">
        <label for="diamCod">Aparelho de Navegação</label><span class="campoObrigatorio">*</span><br>
        <p-dropdown id="diamCod" [options]="listaApNavDisponiveis" [(ngModel)]="objEquipe.apNavCod" autoWidth="false" [style]="{'width':'100%'}" class="p-inputtext-sm inputfield w-full" optionLabel="apNavMarcMod" optionValue="apNavCod" placeholder="Selecione um Apar. de Naveg." [showClear]="true"></p-dropdown>
      </div>
      <div class="field col-12 lg:col-2 md:col-4 sm:col-6">
        <label for="equipStatus">Status</label><span class="campoObrigatorio">*</span>
        <p-selectButton [options]="opcoesStatus" [(ngModel)]="objEquipe.equipStatus" optionLabel="label" optionValue="value"></p-selectButton>
      </div>
  </div>

  <!-- INTEGRANTES DA EQUIPE -->
  <h3>Integrantes:</h3>
  <p-pickList [source]="listaUsuarioTb" [target]="listaUsuarioTbSelecionados" sourceHeader="Disponíveis" targetHeader="Selecionados" [dragdrop]="true"
    [responsive]="true" [sourceStyle]="{'height':'10rem'}" [targetStyle]="{'height':'10rem'}" filterBy="usuNome"
    sourceFilterPlaceholder="Pesquisa por nome" targetFilterPlaceholder="Pesquisa por nome"
    [showSourceControls] = "false"
    [showTargetControls] = "false"
    >
    <ng-template let-item pTemplate="item">
        <div class="product-item">
            <div class="product-list-detail">
                <span class="p-mb-2">{{item.usuNome}}</span>
            </div>
        </div>
    </ng-template>
  </p-pickList>

  <div class="text-right">
    <small><span class="campoObrigatorio">*</span> Campos obrigarórios.</small><br><br>
    <button (click)="Cancelar();" pButton pRipple type="button" label="Cancelar" class="p-button-raised p-button-danger"></button> &nbsp;
    <button (click)="Salvar();" pButton pRipple type="button" label="Salvar" class="p-button-raised p-button-success"></button>
  </div>

</div>

